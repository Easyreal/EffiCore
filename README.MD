# Effi Core Project

## üìå –û–ø–∏—Å–∞–Ω–∏–µ
Effi Core ‚Äî —ç—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –Ω–∞ –±–∞–∑–µ FastAPI,
—Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å—ã –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏) –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–æ–º–æ—â—å—é JWT 
–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —á–µ—Ä–µ–∑ –≥–ª—É–±–æ–∫—É—é —Å–≤–µ—Ä—Ç–æ—á–Ω—É—é –Ω–µ–π—Ä–æ–Ω–Ω—É—é —Å–µ—Ç—å (CNN).
---

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- **backend (FastAPI)**  
  –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç RestAPI
- **postgres (PostgreSQL 15)**  
  –û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö.  
- **redis (Redis 7)**  
  –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è Celery.
- **celery (Celery worker)**  
  –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- **frontend (React + Nginx)**  
  –í–µ–±‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
### Backend
- **Python**
- **FastAPI**
- **PostgreSQL**
- **Redis**
- **Celery**
- **Docker**
### Frontend
- **JavaScript**
- **React**
- **Nginx**
### DLM
- **Python**
- **PyTorch**
- **Matplotlib**
- **numpy**
- **Pandas**
- **scikit-learn**


---
## üîìJWT
- **access_token** ‚Äî —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º–∏
- **refresh_token** ‚Äî —Ç–æ–∫–µ–Ω –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è access_token
- **confirm_token** ‚Äî —Ç–æ–∫–µ–Ω –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ—á—Ç—ã
- **reset_token** ‚Äî —Ç–æ–∫–µ–Ω –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
---

## üîó API —Ä—É—á–∫–∏ (Backend)

### Auth
- `GET /auth/user/me` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ  
- `POST /auth/login` ‚Äî –≤—Ö–æ–¥ –ø–æ email –∏ –ø–∞—Ä–æ–ª—é  
- `POST /auth/logout` ‚Äî –≤—ã—Ö–æ–¥  
- `POST /auth/register` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
- `GET /auth/confirm/email/{token}` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email  
- `POST /auth/refresh` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞  
- `POST /auth/reset` ‚Äî –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è (–ø–µ—Ä–≤–∞—è —Å—Ç–∞–¥–∏—è)  
- `PATCH /auth/reset/email_confirmed/{token}` ‚Äî —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è (–ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç–∞–¥–∏—è)  

### Face
- `POST /face/create` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ª–∏—Ü–∞ (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)  
- `POST /face/verify` ‚Äî –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏—Ü–∞ (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º)  

---

## üåê –†—É—á–∫–∏ —Å—Ç–∞—Ç–∏–∫–∞ (Frontend)


- `/login`  
  –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞.  
  - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é (`/register`) –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è (`/reset-password`).

- `/register`  
  –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
  - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞ (`/login`).

- `/reset-password`  
  –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è.  
  - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –≤—Ö–æ–¥ (`/login`) –∏–ª–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é (`/`).

- `/confirm-email/:token`  
  –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email –ø–æ —Ç–æ–∫–µ–Ω—É.

- `/reset-password/:token`  
  –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –ø–æ —Ç–æ–∫–µ–Ω—É.

- `/dashboard`  
  –ó–∞—â–∏—â—ë–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º).  

- `/`  
  –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ `/login`.

---
## üìö –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

–î–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥–∞—Ç–∞—Å–µ—Ç  
[Labelled Faces in the Wild (LFW) Dataset](https://www.kaggle.com/datasets/jessicali9530/lfw-dataset)

### üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- Backbone: ResNet‚Äë18
- –≠–º–±–µ–¥–¥–∏–Ω–≥: 128‚Äë–º–µ—Ä–Ω—ã–π –≤–µ–∫—Ç–æ—Ä
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (L2)

### –ú–µ—Ç—Ä–∏–∫–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –Ω–∞–±–æ—Ä–µ:
- **Loss:** 0.3822  
- **AUC (Area Under Curve):** 0.7657  
- **EER (Equal Error Rate):** 0.3176  
- **Threshold (EER):** -0.9524
___


## üìÇ .env –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–ü—Ä–∏–º–µ—Ä `.env` —Ñ–∞–π–ª–∞:

```env
#–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
DB_HOST=postgres
DB_PORT=5432
DB_USER=admin
DB_PASS=admin
DB_NAME=effi_core

#–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ JWT
SECRET_KEY=YTnpdIfKLY36v0UcnRBBzlnL9DqAgC2oBWPCRbuK3nI= (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT)
HASH=HS256 (–∫–æ–¥–∏—Ä–æ–≤–∫–∞ –¥–ª—è JWT)

#–ù–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP
SMTP_HOST=smtp.mail.ru
SMTP_PORT=465
SMTP_EMAIL= example@mail.ru (–≤ —Å–ª—É—á–∞–µ SMTP=0, –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º)
SMTP_PASS= examplepassword (–≤ —Å–ª—É—á–∞–µ SMTP=0, –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º)
SMTP=0 (—Ñ–ª–∞–≥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ SMTP –ø—Ä–æ—Ç–æ–∫–æ–ª 0-–≤—ã–∫–ª, 1-–≤–∫–ª.
–ü—Ä–∏ SMTP=0 - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ—á—Ç—ã –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–æ)

#–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë—Ä–æ–∫–µ—Ä–∞ –∑–∞–¥–∞—á
REDIS_HOST=redis
REDIS_PORT=6379

#–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (DLM)
DEVICE=mps
MAX_FILE_SIZE_MB=15 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞)
IMG_SIZE=100 (—Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (100x100) ‚Äî –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ä–∞–∑–º–µ—Ä–æ–º, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏.)
MODEL_WEIGHTS_PATH="weights/best_checkpoint.pth" (–ø—É—Ç—å –¥–æ –≤–µ—Å–æ–≤)
EMBED_DIM=128 (—Ä–∞–∑–º–µ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–∞)
THRESHOLD_DEFAULT=0.5 (–¥–æ–ø—É—Å—Ç–∏–º–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ —Ñ–æ—Ç–æ)
```
---

## üöÄ –ó–∞–ø—É—Å–∫

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **Docker** –∏ **Docker Compose** –Ω–∞ –≤–∞—à—É —Å–∏—Å—Ç–µ–º—É.

2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ –ø—Ä–∏–º–µ—Ä—É –≤—ã—à–µ.

3. –°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã:
   ```bash
   docker compose up --build

4. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ —Ñ–æ–Ω–µ (
   ```bash
   docker compose up -d
5. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
- **Backend (FastAPI) ‚Üí http://localhost:8000**
- **Frontend (React + Nginx) ‚Üí http://localhost:80**
- **Swagger UI (API docs) ‚Üí http://localhost:8000/docs**
6. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:
   ```bash
   docker compose down